Version 4
SHEET 1 2920 2036
WIRE 1376 -128 1136 -128
WIRE 1728 -128 1456 -128
WIRE 80 -48 -224 -48
WIRE 432 -48 80 -48
WIRE 592 -48 528 -48
WIRE 848 -48 688 -48
WIRE 928 -48 848 -48
WIRE 1136 -48 1136 -128
WIRE 1136 -48 928 -48
WIRE 848 -16 848 -48
WIRE 1728 0 1728 -128
WIRE 1888 0 1728 0
WIRE 2160 0 1888 0
WIRE 2320 0 2256 0
WIRE 2576 0 2416 0
WIRE 2864 0 2576 0
WIRE 1136 16 1136 -48
WIRE 2576 32 2576 0
WIRE -224 48 -224 -48
WIRE 1728 48 1728 0
WIRE 672 80 672 0
WIRE 848 80 848 48
WIRE 848 80 672 80
WIRE 2032 80 1968 80
WIRE 2176 80 2176 48
WIRE 2176 80 2032 80
WIRE 2864 96 2864 0
WIRE 448 112 448 0
WIRE 672 112 672 80
WIRE 1440 112 1440 -80
WIRE 1552 112 1440 112
WIRE 1680 112 1616 112
WIRE 1136 128 1136 96
WIRE 2400 128 2400 48
WIRE 2576 128 2576 96
WIRE 2576 128 2400 128
WIRE 1440 144 1440 112
WIRE 2176 160 2176 80
WIRE 2400 160 2400 128
WIRE -896 192 -896 112
WIRE 1728 192 1728 128
WIRE -224 208 -224 128
WIRE 448 224 448 192
WIRE 672 224 672 192
WIRE 2864 240 2864 176
WIRE 2176 272 2176 240
WIRE 2400 272 2400 240
WIRE 1728 304 1728 272
WIRE 272 384 16 384
WIRE 848 384 848 80
WIRE 848 384 272 384
WIRE 2576 384 2576 128
WIRE 2576 384 848 384
WIRE 16 416 16 384
WIRE 16 528 16 496
FLAG -224 208 0
FLAG 16 528 0
FLAG 448 224 0
FLAG 672 224 0
FLAG 928 -48 BATT_in
FLAG 1728 304 0
FLAG 2176 272 0
FLAG 2400 272 0
FLAG 1888 0 BATT_out
FLAG 2864 240 0
FLAG 80 -48 VCC_solar
FLAG 272 384 Vcc_USB
FLAG 2032 80 BMS_signal
FLAG -896 112 BMS_signal
FLAG -896 272 0
FLAG 1136 128 0
FLAG 1680 64 0
FLAG 1392 -80 0
FLAG 1440 224 0
SYMBOL pmos 592 0 R270
SYMATTR InstName M1
SYMBOL voltage -224 32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Solar
SYMATTR Value PWL(0 6 0.1 15 0.3 15 0.45 0)
SYMBOL voltage 16 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=0.01
SYMATTR InstName VBus
SYMATTR Value 0
SYMBOL pmos 528 0 M270
SYMATTR InstName M2
SYMBOL res 432 96 R0
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL res 656 96 R0
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL diode 864 48 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL voltage 1728 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=0.075
SYMATTR InstName Li_ion_cells
SYMATTR Value PWL(0 4.2 0.3 4.2 0.5 2.4)
SYMBOL pmos 2320 48 R270
SYMATTR InstName M3
SYMBOL pmos 2256 48 M270
SYMATTR InstName M4
SYMBOL res 2160 144 R0
SYMATTR InstName R4
SYMATTR Value 100k
SYMBOL res 2384 144 R0
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL diode 2592 96 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL res 2848 80 R0
SYMATTR InstName R6
SYMATTR Value 10
SYMBOL bv -896 176 R0
SYMATTR InstName B1
SYMATTR Value V = if(V(BATT_OUT)< 3,V(BATT_OUT),0)
SYMBOL sw 1360 -128 R270
SYMATTR InstName S1
SYMBOL bi 1136 16 R0
SYMATTR InstName B2
SYMATTR Value I=10/ V(BATT_in)
SYMBOL sw 1728 32 R0
SYMATTR InstName S2
SYMBOL Digital\\inv 1552 48 R0
SYMATTR InstName A1
SYMBOL voltage 1440 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 0
TEXT -936 496 Left 2 !.tran 0.5 startup
TEXT -936 536 Left 2 !.model sw sw vt=1
TEXT -936 568 Left 2 !.model testn nmos(kp=90u vt0=1 lambda=0.01)
TEXT -936 600 Left 2 !.model testn pmos(kp=90u vt0=1 lambda=0.01)
