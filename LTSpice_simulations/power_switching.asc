Version 4
SHEET 1 2376 2036
WIRE 80 -48 -224 -48
WIRE 432 -48 80 -48
WIRE 592 -48 528 -48
WIRE 848 -48 688 -48
WIRE 928 -48 848 -48
WIRE 1040 -48 928 -48
WIRE 848 -16 848 -48
WIRE 1344 0 1184 0
WIRE 1616 0 1344 0
WIRE 1776 0 1712 0
WIRE 2032 0 1872 0
WIRE 2320 0 2032 0
WIRE 2032 32 2032 0
WIRE 2320 32 2320 0
WIRE -224 48 -224 -48
WIRE 672 80 672 0
WIRE 848 80 848 48
WIRE 848 80 672 80
WIRE 1488 80 1424 80
WIRE 1632 80 1632 48
WIRE 1632 80 1488 80
WIRE 448 112 448 0
WIRE 672 112 672 80
WIRE 1856 128 1856 48
WIRE 2032 128 2032 96
WIRE 2032 128 1856 128
WIRE 1632 160 1632 80
WIRE 1856 160 1856 128
WIRE 1184 192 1184 0
WIRE -224 208 -224 128
WIRE 448 224 448 192
WIRE 672 224 672 192
WIRE 1632 272 1632 240
WIRE 1856 272 1856 240
WIRE 1184 304 1184 272
WIRE 272 384 16 384
WIRE 848 384 848 80
WIRE 848 384 272 384
WIRE 2032 384 2032 128
WIRE 2032 384 848 384
WIRE 16 416 16 384
WIRE 16 528 16 496
WIRE 176 816 32 816
WIRE -528 832 -528 576
WIRE -560 848 -656 848
WIRE 176 848 176 816
WIRE -144 864 -144 736
WIRE -144 864 -496 864
WIRE -560 880 -688 880
WIRE 32 896 32 816
WIRE -688 912 -688 880
WIRE 176 976 176 928
WIRE 336 1376 64 1376
WIRE 496 1376 432 1376
WIRE 672 1376 592 1376
WIRE 832 1376 672 1376
WIRE 944 1376 832 1376
WIRE 1248 1424 1088 1424
WIRE 1520 1424 1248 1424
WIRE 1680 1424 1616 1424
WIRE 2064 1424 1776 1424
WIRE 2224 1424 2064 1424
WIRE 2224 1456 2224 1424
WIRE 1392 1504 1328 1504
WIRE 1536 1504 1536 1472
WIRE 1536 1504 1392 1504
WIRE 352 1536 352 1424
WIRE 1760 1552 1760 1472
WIRE 1872 1552 1760 1552
WIRE 1936 1552 1872 1552
WIRE 2064 1552 2064 1424
WIRE 2064 1552 2032 1552
WIRE 1536 1584 1536 1504
WIRE 1760 1584 1760 1552
WIRE 672 1632 672 1376
WIRE 704 1632 672 1632
WIRE 1024 1632 800 1632
WIRE 1872 1632 1872 1552
WIRE 1952 1632 1952 1600
WIRE 1952 1632 1872 1632
WIRE 2032 1632 1952 1632
WIRE 352 1648 352 1616
WIRE 784 1680 704 1680
WIRE 1536 1696 1536 1664
WIRE 1760 1696 1760 1664
WIRE 784 1712 784 1680
WIRE 848 1712 784 1712
WIRE 576 1808 576 1424
WIRE 1024 1808 1024 1632
WIRE 1024 1808 576 1808
WIRE 1152 1808 1024 1808
WIRE 1872 1808 1872 1632
WIRE 1872 1808 1152 1808
WIRE 576 1856 576 1808
WIRE 576 1968 576 1936
FLAG -224 208 0
FLAG 16 528 0
FLAG 448 224 0
FLAG 672 224 0
FLAG 928 -48 BATT_in
FLAG 1040 32 0
FLAG 1184 304 0
FLAG 1632 272 0
FLAG 1856 272 0
FLAG 1344 0 BATT_out
FLAG 2320 112 0
FLAG 352 1648 0
FLAG 576 1968 0
FLAG 832 1376 BATT_in
FLAG 944 1456 0
FLAG 1536 1696 0
FLAG 1760 1696 0
FLAG 1248 1424 BATT_out
FLAG 2224 1536 0
FLAG 80 -48 VCC_solar
FLAG 64 1376 VCC_solar
FLAG 272 384 Vcc_USB
FLAG 1152 1808 Vcc_USB
FLAG 1488 80 BMS_signal
FLAG 1392 1504 BMS_signal
FLAG 848 1712 0
FLAG -144 736 BMS_signal
FLAG -528 896 0
FLAG -688 992 0
FLAG -656 848 BATT_out
FLAG -608 576 0
FLAG 32 976 0
FLAG 176 976 0
SYMBOL pmos 592 0 R270
SYMATTR InstName M1
SYMBOL voltage -224 32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Solar
SYMATTR Value PWL(0 6 0.1 15 0.2 15 0.3 0)
SYMBOL voltage 16 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR InstName VBus
SYMATTR Value 0
SYMATTR SpiceLine Rser=0.01
SYMBOL pmos 528 0 M270
SYMATTR InstName M2
SYMBOL res 432 96 R0
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL res 656 96 R0
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL diode 864 48 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL res 1024 -64 R0
SYMATTR InstName R3
SYMATTR Value 10
SYMBOL voltage 1184 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR InstName Li_ion_cells
SYMATTR Value PWL(0 4.2 0.3 4.2 0.5 2.4)
SYMATTR SpiceLine Rser=0.075
SYMBOL pmos 1776 48 R270
SYMATTR InstName M3
SYMBOL pmos 1712 48 M270
SYMATTR InstName M4
SYMBOL res 1616 144 R0
SYMATTR InstName R4
SYMATTR Value 100k
SYMBOL res 1840 144 R0
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL diode 2048 96 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL res 2304 16 R0
SYMATTR InstName R6
SYMATTR Value 10
SYMBOL pmos 496 1424 R270
SYMATTR InstName M5
SYMBOL pmos 432 1424 M270
SYMATTR InstName M6
SYMBOL res 336 1520 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL res 560 1840 R0
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL res 928 1360 R0
SYMATTR InstName R9
SYMATTR Value 10
SYMBOL pmos 1680 1472 R270
SYMATTR InstName M7
SYMBOL pmos 1616 1472 M270
SYMATTR InstName M8
SYMBOL res 1520 1568 R0
SYMATTR InstName R10
SYMATTR Value 100k
SYMBOL res 1744 1568 R0
SYMATTR InstName R11
SYMATTR Value 100k
SYMBOL res 2208 1440 R0
SYMATTR InstName R12
SYMATTR Value 10
SYMBOL nmos 704 1680 R270
SYMATTR InstName M9
SYMBOL nmos 2032 1600 M270
SYMATTR InstName M10
SYMBOL OpAmps\\OP07 -528 800 R0
SYMATTR InstName U1
SYMBOL voltage -688 896 R0
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 3
SYMBOL voltage -512 576 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 3
SYMBOL res 160 832 R0
SYMATTR InstName R13
SYMATTR Value 1
SYMBOL voltage 32 880 R0
SYMATTR InstName V3
SYMATTR Value V(  IF( V(BATT_OUT)< 3, V(BATT_OUT), 0    )
TEXT -258 552 Left 2 !.tran 0.5 startup
